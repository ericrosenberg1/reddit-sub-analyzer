{% extends "base.html" %}
{% block title %}Activity Log - Sub Search{% endblock %}

{% block content %}
<!-- Header -->
<section class="panel p-6 mb-6">
  <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
    <div>
      <p class="section-label">Order History</p>
      <h1 class="mt-2">Activity Log</h1>
      <p class="mt-2 text-gray-400">Track all searches and automated background jobs</p>
    </div>
    <a href="{% url 'home' %}" class="btn-secondary">Back to Home</a>
  </div>
</section>

<!-- Stats -->
<section class="grid gap-4 sm:grid-cols-2 lg:grid-cols-4 mb-6">
  <div class="card p-5">
    <p class="stat-label">Total Searches</p>
    <p class="stat-value mt-2">{{ job_stats.total|default:0 }}</p>
  </div>
  <div class="card p-5 border-sub-green/20">
    <p class="stat-label text-sub-green-light">Completed</p>
    <p class="stat-value mt-2 text-sub-green-light">{{ job_stats.completed|default:0 }}</p>
  </div>
  <div class="card p-5 border-red-700/20">
    <p class="stat-label text-red-300">Failed</p>
    <p class="stat-value mt-2 text-red-300">{{ job_stats.failed|default:0 }}</p>
  </div>
  <div class="card p-5 border-sub-yellow/20">
    <p class="stat-label text-sub-yellow">In Queue</p>
    <p class="stat-value mt-2 text-sub-yellow">{{ queue_count|default:0 }}</p>
    <p class="text-xs text-muted mt-1">{{ job_stats.pending|default:0 }} pending</p>
  </div>
</section>

<!-- Jobs Table -->
<section class="panel overflow-hidden">
  <div class="overflow-x-auto">
    <table class="min-w-[700px]">
      <thead>
        <tr>
          <th class="w-40">When</th>
          <th>Search Details</th>
          <th class="w-28 text-right">Results</th>
          <th class="w-28">Status</th>
        </tr>
      </thead>
      <tbody>
        {% if entries %}
        {% for entry in entries %}
        <tr>
          <td>
            <p class="font-medium">{{ entry.started_display|default:'Pending' }}</p>
          </td>
          <td>
            <p class="font-semibold">{{ entry.keyword|default:'All subreddits' }}</p>
            <p class="text-xs text-muted mt-0.5">
              {% if entry.source == 'sub_search' %}
              <span class="text-sub-yellow">Manual</span>
              {% else %}
              <span class="text-gray-500">{{ entry.source }}</span>
              {% endif %}
            </p>
          </td>
          <td class="text-right">
            <p class="font-semibold">{{ entry.result_count|default:0 }}</p>
            <p class="text-xs text-muted">subs</p>
          </td>
          <td>
            {% if entry.error %}
            <span class="badge badge-error">Error</span>
            {% elif entry.completed_at %}
            <span class="badge badge-success">Complete</span>
            {% else %}
            <span class="badge badge-info">Running</span>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
        {% else %}
        <tr>
          <td colspan="4" class="text-center py-12 text-muted">
            No searches yet. <a href="{% url 'home' %}" class="text-sub-yellow hover:underline">Start your first search!</a>
          </td>
        </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
  <div class="flex items-center justify-between border-t border-dark-600/50 px-4 py-4">
    <p class="text-sm text-muted">Showing recent activity</p>
    <a href="{% url 'all_subs' %}" class="btn-ghost text-sm">View All The Subs</a>
  </div>
</section>
{% endblock %}
