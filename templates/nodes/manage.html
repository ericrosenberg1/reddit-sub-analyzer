{% extends "base.html" %}
{% block title %}Manage Node â€¢ Eric Rosenberg Sub Search{% endblock %}

{% block content %}
<section class="panel-surface p-6 shadow-2xl lg:p-10">
  <div class="space-y-3">
    <p class="text-xs uppercase tracking-[0.3em] text-white/60">Your private link</p>
    <h1 class="font-display text-3xl text-white sm:text-4xl">Manage your volunteer node</h1>
    <p class="text-sm text-white/80">Last check-in: {{ node.last_check_in_at|date:"Y-m-d H:i T"|default:'Just now' }} - Status: <span class="font-semibold text-white">{{ node.health_status|default:'pending'|title }}</span></p>
    <p class="text-xs text-white/60">Bookmark this link: <a href="{{ manage_link }}" class="underline decoration-dotted break-all">{{ manage_link }}</a></p>
  </div>

  <form method="post" class="mt-8 grid gap-6 rounded-3xl border border-white/10 bg-slate-900/60 p-6 shadow-xl lg:grid-cols-2">
    {% csrf_token %}
    <div class="space-y-4">
      <div>
        <label for="email" class="text-sm font-semibold text-white/90">Contact email</label>
        <input type="email" id="email" name="email" required value="{{ node.email|default:'' }}" class="mt-2 w-full rounded-xl border border-white/10 bg-slate-900/80 px-4 py-3 text-white focus:border-brand focus:ring-2 focus:ring-brand/40" />
      </div>
      <div>
        <label for="reddit_username" class="text-sm font-semibold text-white/90">Reddit username</label>
        <input type="text" id="reddit_username" name="reddit_username" required value="{{ node.reddit_username|default:'' }}" class="mt-2 w-full rounded-xl border border-white/10 bg-slate-900/80 px-4 py-3 text-white focus:border-brand focus:ring-2 focus:ring-brand/40" />
      </div>
      <div>
        <label for="location" class="text-sm font-semibold text-white/90">Location / timezone</label>
        <input type="text" id="location" name="location" value="{{ node.location|default:'' }}" class="mt-2 w-full rounded-xl border border-white/10 bg-slate-900/80 px-4 py-3 text-white focus:border-brand focus:ring-2 focus:ring-brand/40" />
      </div>
      <div>
        <label for="availability" class="text-sm font-semibold text-white/90">Availability</label>
        <input type="text" id="availability" name="availability" value="{{ node.availability|default:'' }}" class="mt-2 w-full rounded-xl border border-white/10 bg-slate-900/80 px-4 py-3 text-white focus:border-brand focus:ring-2 focus:ring-brand/40" />
      </div>
      <div>
        <label for="health_status" class="text-sm font-semibold text-white/90">Status</label>
        <select id="health_status" name="health_status" class="mt-2 w-full rounded-xl border border-white/10 bg-slate-900/80 px-4 py-3 text-white focus:border-brand focus:ring-2 focus:ring-brand/40">
          <option value="active" {% if node.health_status == 'active' %}selected{% endif %}>Active (running queries)</option>
          <option value="paused" {% if node.health_status == 'paused' %}selected{% endif %}>Paused (temporarily offline)</option>
          <option value="pending" {% if node.health_status == 'pending' %}selected{% endif %}>Pending (not started yet)</option>
          <option value="broken" {% if node.health_status == 'broken' %}selected{% endif %}>Broken (let cleanup remove me)</option>
        </select>
        <p class="mt-1 text-xs text-white/50">Broken nodes are deleted automatically after 7 days.</p>
      </div>
    </div>
    <div class="space-y-4">
      <div>
        <label for="system_details" class="text-sm font-semibold text-white/90">Hardware</label>
        <textarea id="system_details" name="system_details" rows="3" class="mt-2 w-full rounded-xl border border-white/10 bg-slate-900/80 px-4 py-3 text-white focus:border-brand focus:ring-2 focus:ring-brand/40">{{ node.system_details|default:'' }}</textarea>
      </div>
      <div>
        <label for="bandwidth_notes" class="text-sm font-semibold text-white/90">Bandwidth</label>
        <input type="text" id="bandwidth_notes" name="bandwidth_notes" value="{{ node.bandwidth_notes|default:'' }}" class="mt-2 w-full rounded-xl border border-white/10 bg-slate-900/80 px-4 py-3 text-white focus:border-brand focus:ring-2 focus:ring-brand/40" />
      </div>
      <div>
        <label for="notes" class="text-sm font-semibold text-white/90">Notes / shout-outs</label>
        <textarea id="notes" name="notes" rows="4" class="mt-2 w-full rounded-xl border border-white/10 bg-slate-900/80 px-4 py-3 text-white focus:border-brand focus:ring-2 focus:ring-brand/40">{{ node.notes|default:'' }}</textarea>
      </div>
      <button type="submit" class="w-full rounded-2xl bg-gradient-to-r from-brand to-brand-light px-6 py-3 text-base font-semibold text-slate-950 shadow-brand transition hover:scale-[1.01]">Save changes</button>
    </div>
  </form>

  <form method="post" class="mt-6 rounded-2xl border border-red-500/30 bg-red-500/5 p-5 text-sm text-white/80" onsubmit="return confirm('Remove this node? This cannot be undone.');">
    {% csrf_token %}
    <input type="hidden" name="action" value="delete" />
    <p class="font-semibold text-white">Remove node</p>
    <p class="mt-1 text-white/70">If you no longer want to participate, remove the node. You can always resubmit later.</p>
    <button type="submit" class="mt-3 rounded-full bg-red-500/20 px-4 py-2 text-sm font-semibold text-red-100 hover:bg-red-500/30">Delete node</button>
  </form>
</section>
{% endblock %}
