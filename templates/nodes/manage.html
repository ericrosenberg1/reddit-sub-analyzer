{% extends "base.html" %}
{% block title %}Manage Node - Sub Search{% endblock %}

{% block content %}
<!-- Header -->
<section class="panel p-8 mb-8">
  <p class="section-label">Private Management Link</p>
  <h1 class="mt-3">Manage Your Node</h1>
  <p class="mt-4 text-lg text-gray-400 max-w-3xl">
    Update your node details, change status, or remove your node from the network.
  </p>

  <div class="mt-6 grid gap-4 sm:grid-cols-3">
    <div class="card p-4">
      <div class="flex items-center gap-2 text-gray-400">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
        <span class="text-sm">Last check-in:</span>
      </div>
      <p class="mt-1 font-semibold text-white">{{ node.last_check_in_at|date:"M d, Y H:i"|default:'Just now' }}</p>
    </div>
    <div class="card p-4">
      <div class="flex items-center gap-2 text-gray-400">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
        <span class="text-sm">Current status:</span>
      </div>
      <p class="mt-1">
        <span class="badge {% if node.health_status == 'active' %}badge-success{% elif node.health_status == 'paused' %}badge-warning{% elif node.health_status == 'broken' %}badge-error{% else %}badge-neutral{% endif %}">
          {{ node.health_status|default:'pending'|title }}
        </span>
      </p>
    </div>
    <div class="card p-4">
      <div class="flex items-center gap-2 text-gray-400">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"/>
        </svg>
        <span class="text-sm">Bookmark this:</span>
      </div>
      <p class="mt-1 text-xs text-sub-yellow break-all truncate" title="{{ manage_link }}">{{ manage_link }}</p>
    </div>
  </div>
</section>

<!-- Edit Form -->
<section class="panel p-6 mb-6">
  <div class="flex items-center gap-3 mb-6">
    <div class="w-8 h-8 rounded-lg bg-sub-green/20 flex items-center justify-center">
      <svg class="w-5 h-5 text-sub-green-light" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
      </svg>
    </div>
    <h2>Update Node Details</h2>
  </div>

  <form method="post" class="grid gap-6 lg:grid-cols-2">
    {% csrf_token %}

    <!-- Left Column -->
    <div class="space-y-5">
      <div>
        <label for="email">Contact Email <span class="text-red-400">*</span></label>
        <input type="email" id="email" name="email" required value="{{ node.email|default:'' }}" placeholder="you@example.com">
      </div>
      <div>
        <label for="reddit_username">Reddit Username <span class="text-red-400">*</span></label>
        <input type="text" id="reddit_username" name="reddit_username" required value="{{ node.reddit_username|default:'' }}" placeholder="u/yourname">
      </div>
      <div>
        <label for="location">Location / Timezone</label>
        <input type="text" id="location" name="location" value="{{ node.location|default:'' }}" placeholder="e.g. Portland, OR (UTC-7)">
      </div>
      <div>
        <label for="availability">Availability</label>
        <input type="text" id="availability" name="availability" value="{{ node.availability|default:'' }}" placeholder="e.g. Weeknights, 7pm-midnight">
      </div>
      <div>
        <label for="health_status">Node Status</label>
        <select id="health_status" name="health_status">
          <option value="active" {% if node.health_status == 'active' %}selected{% endif %}>Active (running queries)</option>
          <option value="paused" {% if node.health_status == 'paused' %}selected{% endif %}>Paused (temporarily offline)</option>
          <option value="pending" {% if node.health_status == 'pending' %}selected{% endif %}>Pending (not started yet)</option>
          <option value="broken" {% if node.health_status == 'broken' %}selected{% endif %}>Broken (let cleanup remove me)</option>
        </select>
        <p class="form-help">Broken nodes are deleted automatically after 7 days.</p>
      </div>
    </div>

    <!-- Right Column -->
    <div class="space-y-5">
      <div>
        <label for="system_details">Hardware Details</label>
        <textarea id="system_details" name="system_details" rows="3" placeholder="CPU, RAM, connection details...">{{ node.system_details|default:'' }}</textarea>
      </div>
      <div>
        <label for="bandwidth_notes">Bandwidth</label>
        <input type="text" id="bandwidth_notes" name="bandwidth_notes" value="{{ node.bandwidth_notes|default:'' }}" placeholder="e.g. 500 Mbps fiber, metered weekends">
      </div>
      <div>
        <label for="notes">Notes / Public Bio</label>
        <textarea id="notes" name="notes" rows="3" placeholder="Anything you'd like to share publicly...">{{ node.notes|default:'' }}</textarea>
        <p class="form-help">Shown on the public nodes list</p>
      </div>
    </div>

    <!-- Submit -->
    <div class="lg:col-span-2">
      <button type="submit" class="btn-primary w-full py-4 text-lg">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
        </svg>
        Save Changes
      </button>
    </div>
  </form>
</section>

<!-- Danger Zone -->
<section class="panel p-6 border-red-500/30">
  <div class="flex items-center gap-3 mb-4">
    <div class="w-8 h-8 rounded-lg bg-red-500/20 flex items-center justify-center">
      <svg class="w-5 h-5 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
      </svg>
    </div>
    <div>
      <h2 class="text-red-300">Danger Zone</h2>
      <p class="text-sm text-muted">Irreversible actions</p>
    </div>
  </div>

  <form method="post" onsubmit="return confirm('Remove this node? This cannot be undone.');">
    {% csrf_token %}
    <input type="hidden" name="action" value="delete">
    <div class="card p-5 border-red-500/20 bg-red-500/5">
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
        <div>
          <p class="font-semibold text-red-300">Remove Node</p>
          <p class="text-sm text-muted mt-1">If you no longer want to participate, remove your node from the network. You can always resubmit later.</p>
        </div>
        <button type="submit" class="btn-danger flex-shrink-0">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
          </svg>
          Delete Node
        </button>
      </div>
    </div>
  </form>
</section>
{% endblock %}
