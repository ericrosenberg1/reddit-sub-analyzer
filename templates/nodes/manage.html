{% extends "base.html" %}
{% block title %}Manage Node - Sub Search{% endblock %}

{% block content %}
<section class="panel-surface p-6 lg:p-10">
  <div class="space-y-3">
    <p class="section-label">Your private link</p>
    <h1 class="font-display text-3xl sm:text-4xl">Manage your volunteer node</h1>
    <p class="text-sm">Last check-in: {{ node.last_check_in_at|date:"Y-m-d H:i T"|default:'Just now' }} - Status: <span class="font-semibold">{{ node.health_status|default:'pending'|title }}</span></p>
    <p class="text-xs text-muted">Bookmark this link: <a href="{{ manage_link }}" class="underline decoration-dotted break-all">{{ manage_link }}</a></p>
  </div>

  <form method="post" class="mt-8 grid gap-6 card p-6 lg:grid-cols-2">
    {% csrf_token %}
    <div class="space-y-4">
      <div>
        <label for="email">Contact email</label>
        <input type="email" id="email" name="email" required value="{{ node.email|default:'' }}">
      </div>
      <div>
        <label for="reddit_username">Reddit username</label>
        <input type="text" id="reddit_username" name="reddit_username" required value="{{ node.reddit_username|default:'' }}">
      </div>
      <div>
        <label for="location">Location / timezone</label>
        <input type="text" id="location" name="location" value="{{ node.location|default:'' }}">
      </div>
      <div>
        <label for="availability">Availability</label>
        <input type="text" id="availability" name="availability" value="{{ node.availability|default:'' }}">
      </div>
      <div>
        <label for="health_status">Status</label>
        <select id="health_status" name="health_status">
          <option value="active" {% if node.health_status == 'active' %}selected{% endif %}>Active (running queries)</option>
          <option value="paused" {% if node.health_status == 'paused' %}selected{% endif %}>Paused (temporarily offline)</option>
          <option value="pending" {% if node.health_status == 'pending' %}selected{% endif %}>Pending (not started yet)</option>
          <option value="broken" {% if node.health_status == 'broken' %}selected{% endif %}>Broken (let cleanup remove me)</option>
        </select>
        <p class="form-help">Broken nodes are deleted automatically after 7 days.</p>
      </div>
    </div>
    <div class="space-y-4">
      <div>
        <label for="system_details">Hardware</label>
        <textarea id="system_details" name="system_details" rows="3">{{ node.system_details|default:'' }}</textarea>
      </div>
      <div>
        <label for="bandwidth_notes">Bandwidth</label>
        <input type="text" id="bandwidth_notes" name="bandwidth_notes" value="{{ node.bandwidth_notes|default:'' }}">
      </div>
      <div>
        <label for="notes">Notes / shout-outs</label>
        <textarea id="notes" name="notes" rows="4">{{ node.notes|default:'' }}</textarea>
      </div>
      <button type="submit" class="w-full">Save changes</button>
    </div>
  </form>

  <form method="post" class="mt-6 card p-5 border-red-500/30" onsubmit="return confirm('Remove this node? This cannot be undone.');">
    {% csrf_token %}
    <input type="hidden" name="action" value="delete">
    <p class="font-semibold">Remove node</p>
    <p class="mt-1 text-sm text-muted">If you no longer want to participate, remove the node. You can always resubmit later.</p>
    <button type="submit" class="btn-danger mt-3 px-4 py-2 rounded-xl text-sm">Delete node</button>
  </form>
</section>
{% endblock %}
