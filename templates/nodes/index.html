{% extends "base.html" %}
{% block title %}Volunteer Nodes - Sub Search{% endblock %}

{% block content %}
<!-- Hero -->
<div class="card mb-4">
  <div class="card-body p-4">
    <div class="row align-items-center">
      <div class="col-lg-7">
        <p class="stat-label mb-2">Distributed Kitchen</p>
        <h1 class="h2 mb-3">Volunteer Your Machine</h1>
        <p class="text-muted mb-4">
          Help us build the world's largest subreddit directory. Bring your computer + Reddit account to accelerate data collection.
        </p>
        <a href="{% url 'node_join' %}" class="btn btn-primary">
          <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
          </svg>
          Add Your Node
        </a>
      </div>

      <!-- Stats -->
      <div class="col-lg-5 mt-4 mt-lg-0">
        <div class="row g-3">
          <div class="col-4">
            <div class="bg-input rounded p-3 text-center">
              <p class="stat-label mb-1">Total</p>
              <p class="stat-value text-success mb-0">{{ node_stats.total|default:0 }}</p>
            </div>
          </div>
          <div class="col-4">
            <div class="bg-input rounded p-3 text-center">
              <p class="stat-label mb-1">Active</p>
              <p class="stat-value mb-0">{{ node_stats.active|default:0 }}</p>
            </div>
          </div>
          <div class="col-4">
            <div class="bg-input rounded p-3 text-center">
              <p class="stat-label mb-1">Pending</p>
              <p class="stat-value text-warning mb-0">{{ node_stats.pending|default:0 }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- How It Works -->
<div class="card mb-4">
  <div class="card-body">
    <div class="d-flex align-items-center gap-3 mb-4">
      <div class="rounded d-flex align-items-center justify-content-center" style="width: 32px; height: 32px; background-color: rgba(70, 209, 96, 0.2);">
        <svg width="18" height="18" class="text-success" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
        </svg>
      </div>
      <h4 class="mb-0">How Nodes Work</h4>
    </div>

    <div class="row g-4">
      <div class="col-md-4">
        <div class="d-flex gap-3">
          <div class="rounded-circle d-flex align-items-center justify-content-center flex-shrink-0" style="width: 40px; height: 40px; background-color: var(--ss-success);">
            <span class="text-white fw-bold">1</span>
          </div>
          <div>
            <p class="fw-semibold mb-1">Register Your Node</p>
            <p class="small text-muted mb-0">Submit your Reddit account and machine details. We'll email you a private management link.</p>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="d-flex gap-3">
          <div class="rounded-circle d-flex align-items-center justify-content-center flex-shrink-0" style="width: 40px; height: 40px; background-color: var(--ss-success);">
            <span class="text-white fw-bold">2</span>
          </div>
          <div>
            <p class="fw-semibold mb-1">Run Sub Search Locally</p>
            <p class="small text-muted mb-0">Install the app on your machine with PHONE_HOME enabled. Each search syncs to the main database.</p>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="d-flex gap-3">
          <div class="rounded-circle d-flex align-items-center justify-content-center flex-shrink-0" style="width: 40px; height: 40px; background-color: var(--ss-success);">
            <span class="text-white fw-bold">3</span>
          </div>
          <div>
            <p class="fw-semibold mb-1">Grow the Dataset</p>
            <p class="small text-muted mb-0">Your searches contribute to the shared subreddit directory for everyone to use.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Active Nodes -->
<div class="card mb-4">
  <div class="card-body">
    <div class="d-flex align-items-center justify-content-between mb-4">
      <div class="d-flex align-items-center gap-3">
        <div class="rounded d-flex align-items-center justify-content-center" style="width: 32px; height: 32px; background-color: rgba(255, 214, 53, 0.2);">
          <svg width="18" height="18" class="text-warning" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.636 18.364a9 9 0 010-12.728m12.728 0a9 9 0 010 12.728m-9.9-2.829a5 5 0 010-7.07m7.072 0a5 5 0 010 7.07M13 12a1 1 0 11-2 0 1 1 0 012 0z"/>
          </svg>
        </div>
        <div>
          <h4 class="mb-0">Active Nodes</h4>
          <p class="small text-muted mb-0">Community contributors keeping the data fresh</p>
        </div>
      </div>
      <a href="{% url 'node_join' %}" class="btn btn-link btn-sm">Join the network</a>
    </div>

    {% if volunteer_nodes %}
    <div class="row g-3">
      {% for node in volunteer_nodes %}
      <div class="col-md-6">
        <div class="bg-input rounded p-4">
          <div class="d-flex align-items-start justify-content-between gap-3 mb-3">
            <div class="d-flex align-items-center gap-3">
              <div class="rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px; background-color: rgba(70, 209, 96, 0.2);">
                <svg width="18" height="18" class="text-success" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                </svg>
              </div>
              <div>
                <p class="fw-semibold mb-0">{% if node.reddit_username %}u/{{ node.reddit_username }}{% else %}Pending...{% endif %}</p>
                <p class="small text-muted mb-0">{{ node.location|default:'Location TBD' }}</p>
              </div>
            </div>
            <span class="badge {% if node.health_status == 'active' %}bg-success{% elif node.health_status == 'paused' %}bg-warning{% else %}bg-secondary{% endif %}">
              {{ node.health_status|default:'pending'|title }}
            </span>
          </div>

          <div class="small">
            {% if node.system_details %}
            <div class="d-flex gap-2 mb-1">
              <span class="text-muted" style="width: 80px;">Hardware:</span>
              <span>{{ node.system_details }}</span>
            </div>
            {% endif %}
            {% if node.availability %}
            <div class="d-flex gap-2 mb-1">
              <span class="text-muted" style="width: 80px;">Schedule:</span>
              <span>{{ node.availability }}</span>
            </div>
            {% endif %}
            {% if node.bandwidth_notes %}
            <div class="d-flex gap-2 mb-1">
              <span class="text-muted" style="width: 80px;">Bandwidth:</span>
              <span>{{ node.bandwidth_notes }}</span>
            </div>
            {% endif %}
            <div class="d-flex gap-2">
              <span class="text-muted" style="width: 80px;">Last seen:</span>
              <span>{{ node.last_check_in_at|date:"M d, Y H:i"|default:'New' }}</span>
            </div>
          </div>

          {% if node.notes %}
          <div class="mt-3 p-3 rounded" style="background-color: var(--ss-bg-card);">
            <p class="small text-muted fst-italic mb-0">"{{ node.notes }}"</p>
          </div>
          {% endif %}
        </div>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <div class="text-center py-5">
      <div class="rounded-circle d-flex align-items-center justify-content-center mx-auto mb-3" style="width: 64px; height: 64px; background-color: var(--ss-bg-input);">
        <svg width="32" height="32" class="text-muted" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
        </svg>
      </div>
      <p class="text-muted mb-1">No volunteer nodes yet.</p>
      <p class="small text-muted">Be the first to join the network!</p>
      <a href="{% url 'node_join' %}" class="btn btn-primary mt-3">Add Your Node</a>
    </div>
    {% endif %}
  </div>
</div>

<!-- CTA -->
<div class="row g-4">
  <div class="col-md-6">
    <div class="card h-100">
      <div class="card-body">
        <p class="stat-label mb-2">Self-Host Friendly</p>
        <h5>Run Your Own Instance</h5>
        <p class="small text-muted mb-3">
          Clone the repo, configure your Reddit API credentials, and enable PHONE_HOME to sync your searches with the main database.
        </p>
        <a href="{% url 'developer_docs' %}" class="btn btn-link btn-sm ps-0">View Setup Guide</a>
      </div>
    </div>
  </div>
  <div class="col-md-6">
    <div class="card h-100">
      <div class="card-body">
        <p class="stat-label mb-2">Node Cleanup</p>
        <h5>Automatic Maintenance</h5>
        <p class="small text-muted mb-0">
          Nodes marked as "broken" are automatically removed after 7 days. Update your status via your private management link.
        </p>
      </div>
    </div>
  </div>
</div>
{% endblock %}
