{% extends "base.html" %}
{% block title %}Developer Docs - Sub Search{% endblock %}

{% block content %}
<section class="panel-surface p-6 lg:p-10">
  <p class="section-label">Developers</p>
  <h1 class="mt-2 font-display text-3xl sm:text-4xl">Build and deploy Sub Search</h1>
  <p class="mt-3 max-w-3xl text-sm">These steps assume you're comfortable with a terminal. Follow them from top to bottom to clone the repo, configure environment variables, run the web UI, and optionally feed the global dataset via <code>PHONE_HOME</code>.</p>
</section>

<section class="panel-surface mt-8 p-6">
  <h2>1. Clone & install</h2>
  <ol class="mt-4 space-y-3 text-sm">
    <li>1. Install Python 3.10+ and git.</li>
    <li>2. Clone the project & create a virtualenv:
      <pre class="mt-2"><code>git clone https://github.com/ericrosenberg1/reddit-sub-analyzer.git
cd reddit-sub-analyzer
python3 -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt</code></pre>
    </li>
    <li>3. Set up PostgreSQL and Redis (required):
      <pre class="mt-2"><code># PostgreSQL
createdb subsearch

# Redis (via Docker or local install)
docker run -d --name redis -p 6379:6379 redis:alpine</code></pre>
    </li>
    <li>4. Run database migrations and start the server:
      <pre class="mt-2"><code>python manage.py migrate
python manage.py runserver  # serves http://localhost:8000</code></pre>
    </li>
    <li>5. Start Celery workers (in a separate terminal):
      <pre class="mt-2"><code>celery -A reddit_analyzer worker --loglevel=info</code></pre>
    </li>
  </ol>
</section>

<section class="panel-surface mt-6 p-6">
  <h2>2. Configure your .env</h2>
  <p class="mt-2 text-sm">Copy <code>.env.example</code> to <code>.env</code> and fill in the essentials:</p>
  <ul class="mt-3 space-y-2 text-sm">
    <li><span class="font-semibold">Reddit API:</span> <code>REDDIT_CLIENT_ID</code>, <code>REDDIT_CLIENT_SECRET</code>, <code>REDDIT_USERNAME</code>, <code>REDDIT_PASSWORD</code>, <code>REDDIT_USER_AGENT</code>.</li>
    <li><span class="font-semibold">Django:</span> <code>SECRET_KEY</code>, <code>DEBUG</code>, <code>ALLOWED_HOSTS</code>.</li>
    <li><span class="font-semibold">Database:</span> <code>DATABASE_URL</code> (PostgreSQL connection string).</li>
    <li><span class="font-semibold">Redis:</span> <code>REDIS_URL</code> for Celery and caching.</li>
    <li><span class="font-semibold">Job controls:</span> tune <code>CELERY_BROKER_URL</code> and worker concurrency as needed.</li>
  </ul>
</section>

<section class="panel-surface mt-6 p-6">
  <h2>3. Deploy to a server</h2>
  <p class="mt-2 text-sm">For production, use Gunicorn with your preferred process manager:</p>
  <pre class="mt-3"><code>pip install gunicorn
gunicorn reddit_analyzer.wsgi:application --bind 0.0.0.0:8000 --workers 4</code></pre>
  <p class="mt-3 text-sm">Use systemd, supervisor, or Docker to manage the Django app and Celery workers.</p>
</section>

<section class="panel-surface mt-6 p-6">
  <h2>4. Stream data back with PHONE_HOME</h2>
  <ol class="mt-3 space-y-2 text-sm">
    <li>1. Set <code>PHONE_HOME=true</code> in your <code>.env</code>.</li>
    <li>2. Point <code>PHONE_HOME_ENDPOINT</code> at <code>https://allthesubs.ericrosenberg.com/api/ingest</code> (default) or your own collector.</li>
    <li>3. Add <code>PHONE_HOME_TOKEN</code> if you received one (Bearer auth). Otherwise the sync runs anonymously.</li>
    <li>4. Optional: customize <code>PHONE_HOME_SOURCE</code> to label your node in downstream metrics.</li>
    <li>5. Run Sub Search as usual—every evaluated subreddit syncs to the main directory automatically.</li>
  </ol>
</section>

<section class="panel-surface mt-6 p-6">
  <h2>5. Volunteer a node</h2>
  <p class="mt-2 text-sm">Nodes add extra throughput by lending your computer + Reddit account:</p>
  <ul class="mt-3 space-y-2 text-sm">
    <li>Open the <a class="underline decoration-dotted" href="{% url 'nodes_home' %}">Nodes</a> page and submit the "Add a node" form.</li>
    <li>Use the private link emailed to you to update availability, hardware, or to pause/remove the node.</li>
    <li>Mark a node as "broken" if it goes offline—Sub Search automatically prunes broken nodes after seven days.</li>
  </ul>
</section>

<section class="panel-surface mt-6 p-6">
  <h2>Stay involved</h2>
  <div class="mt-4 grid gap-4 md:grid-cols-2">
    <article class="card p-5">
      <p class="section-label">Report & discuss</p>
      <p class="mt-2 text-sm">Share bugs, feature requests, or architectural ideas via GitHub issues.</p>
      <a class="mt-3 inline-flex items-center gap-2 text-brand hover:text-brand-light" href="https://github.com/ericrosenberg1/reddit-sub-analyzer/issues" target="_blank" rel="noopener">GitHub Issues →</a>
    </article>
    <article class="card p-5">
      <p class="section-label">Hack on the repo</p>
      <p class="mt-2 text-sm">Fork the repository, open pull requests, and help expand the toolset.</p>
      <a class="mt-3 inline-flex items-center gap-2 text-brand hover:text-brand-light" href="https://github.com/ericrosenberg1/reddit-sub-analyzer" target="_blank" rel="noopener">View Repository →</a>
    </article>
  </div>
</section>
{% endblock %}
