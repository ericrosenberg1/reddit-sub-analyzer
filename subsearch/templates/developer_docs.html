{% extends "base.html" %}
{% block title %}Developer Docs • Eric Rosenberg Sub Search{% endblock %}

{% block content %}
<section class="panel-surface p-6 shadow-2xl lg:p-10">
  <p class="text-xs uppercase tracking-[0.3em] text-white/60">Developers</p>
  <h1 class="mt-2 font-display text-3xl text-white sm:text-4xl">Build and deploy Sub Search</h1>
  <p class="mt-3 max-w-3xl text-sm text-white/80">These steps assume you’re comfortable with a terminal but new to Flask apps. Follow them from top to bottom to clone the repo, configure environment variables, run the web UI, and optionally feed the global dataset via <code>PHONE_HOME</code>.</p>
</section>

<section class="panel-surface mt-8 p-6 shadow-xl">
  <h2 class="text-2xl font-semibold text-white">1. Clone & install</h2>
  <ol class="mt-4 space-y-3 text-sm text-white/80">
    <li>1. Install Python 3.9+ and git.</li>
    <li>2. Clone the project &amp; create a virtualenv:
      <pre class="mt-2 rounded-2xl bg-slate-900/70 p-4 text-xs text-white/90"><code>git clone https://github.com/ericrosenberg1/reddit-sub-analyzer.git
cd reddit-sub-analyzer
python3 -m venv venv
source venv/bin/activate
pip install -e .</code></pre>
    </li>
    <li>3. Launch the web server locally:
      <pre class="mt-2 rounded-2xl bg-slate-900/70 p-4 text-xs text-white/90"><code>subsearch  # serves http://localhost:5055</code></pre>
    </li>
  </ol>
</section>

<section class="panel-surface mt-6 p-6 shadow-xl">
  <h2 class="text-2xl font-semibold text-white">2. Configure your .env</h2>
  <p class="mt-2 text-sm text-white/80">Copy <code>.env.example</code> → <code>.env</code> and fill in the essentials:</p>
  <ul class="mt-3 space-y-2 text-sm text-white/80">
    <li><span class="font-semibold text-white">Reddit API:</span> <code>REDDIT_CLIENT_ID</code>, <code>REDDIT_CLIENT_SECRET</code>, <code>REDDIT_USERNAME</code>, <code>REDDIT_PASSWORD</code>, <code>REDDIT_USER_AGENT</code>.</li>
    <li><span class="font-semibold text-white">Runtime:</span> <code>FLASK_SECRET_KEY</code>, <code>SITE_URL</code>, <code>PORT</code>.</li>
    <li><span class="font-semibold text-white">Database:</span> leave <code>DB_TYPE=sqlite</code> for local testing or point to Postgres with the <code>DB_POSTGRES_*</code> variables.</li>
    <li><span class="font-semibold text-white">Job controls:</span> tune <code>SUBSEARCH_MAX_CONCURRENT_JOBS</code> and <code>SUBSEARCH_RATE_LIMIT_DELAY</code> if you expect heavy traffic.</li>
  </ul>
</section>

<section class="panel-surface mt-6 p-6 shadow-xl">
  <h2 class="text-2xl font-semibold text-white">3. Deploy to a server</h2>
  <p class="mt-2 text-sm text-white/80">Use the included helper script to keep prod builds consistent:</p>
  <pre class="mt-3 rounded-2xl bg-slate-900/70 p-4 text-xs text-white/90"><code>sudo install -m0755 scripts/deploy_subsearch.sh /usr/local/bin/deploy_subsearch.sh
sudo APP_DIR=/opt/subsearch VENV_PATH=/opt/subsearch/venv \
     SERVICE_NAME=subsearch APP_USER=www-data \
     /usr/local/bin/deploy_subsearch.sh</code></pre>
  <p class="mt-3 text-sm text-white/80">The script pulls <code>origin/main</code>, reinstalls dependencies inside the venv, and restarts your systemd unit.</p>
</section>

<section class="panel-surface mt-6 p-6 shadow-xl">
  <h2 class="text-2xl font-semibold text-white">4. Stream data back with PHONE_HOME</h2>
  <ol class="mt-3 space-y-2 text-sm text-white/80">
    <li>1. Set <code>PHONE_HOME=true</code> in your <code>.env</code>.</li>
    <li>2. Point <code>PHONE_HOME_ENDPOINT</code> at <code>https://allthesubs.ericrosenberg.com/api/ingest</code> (default) or your own collector.</li>
    <li>3. Add <code>PHONE_HOME_TOKEN</code> if you received one (Bearer auth). Otherwise the sync runs anonymously.</li>
    <li>4. Optional: customize <code>PHONE_HOME_SOURCE</code> to label your node in downstream metrics.</li>
    <li>5. Run Sub Search as usual—every evaluated subreddit syncs to the main directory automatically.</li>
  </ol>
</section>

<section class="panel-surface mt-6 p-6 shadow-xl">
  <h2 class="text-2xl font-semibold text-white">5. Volunteer a node</h2>
  <p class="mt-2 text-sm text-white/80">Nodes add extra throughput by lending your computer + Reddit account:</p>
  <ul class="mt-3 space-y-2 text-sm text-white/80">
    <li>Open the <a class="underline decoration-dotted" href="{{ url_for('nodes_home') }}">Nodes</a> page and submit the “Add a node” form.</li>
    <li>Use the private link emailed to you to update availability, hardware, or to pause/remove the node.</li>
    <li>Mark a node as “broken” if it goes offline—Sub Search automatically prunes broken nodes after seven days.</li>
  </ul>
</section>

<section class="panel-surface mt-6 p-6 shadow-xl">
  <h2 class="text-2xl font-semibold text-white">Stay involved</h2>
  <div class="mt-4 grid gap-4 md:grid-cols-2 text-sm text-white/80">
    <article class="rounded-2xl border border-white/10 bg-slate-900/60 p-5">
      <p class="text-xs uppercase tracking-[0.3em] text-white/50">Report & discuss</p>
      <p class="mt-2">Share bugs, feature requests, or architectural ideas via GitHub issues.</p>
      <a class="mt-3 inline-flex items-center gap-2 text-brand hover:text-white" href="https://github.com/ericrosenberg1/reddit-sub-analyzer/issues" target="_blank" rel="noopener">GitHub Issues →</a>
    </article>
    <article class="rounded-2xl border border-white/10 bg-slate-900/60 p-5">
      <p class="text-xs uppercase tracking-[0.3em] text-white/50">Hack on the repo</p>
      <p class="mt-2">Fork https://github.com/ericrosenberg1/reddit-sub-analyzer, open pull requests, and help expand the toolset.</p>
      <a class="mt-3 inline-flex items-center gap-2 text-brand hover:text-white" href="https://github.com/ericrosenberg1/reddit-sub-analyzer" target="_blank" rel="noopener">View Repository →</a>
    </article>
  </div>
</section>
{% endblock %}
