<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Settings • Subsearch</title>
    {% if site_url %}
    <link rel="canonical" href="{{ site_url }}" />
    {% endif %}
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Cdefs%3E%3CradialGradient id='g' cx='50%25' cy='50%25' r='60%25'%3E%3Cstop offset='0%25' stop-color='%2322d3ee'/%3E%3Cstop offset='100%25' stop-color='%237c3aed'/%3E%3C/radialGradient%3E%3C/defs%3E%3Crect width='64' height='64' rx='14' fill='url(%23g)'/%3E%3Ccircle cx='32' cy='32' r='10' fill='white' opacity='0.9'/%3E%3C/svg%3E" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  </head>
  <body>
    <div class="page">
      <div class="container">
        <div class="panel">
          <div class="panel-head">
            <div class="brand"><span class="dot"></span>Subsearch Settings</div>
            <div class="nav-right"><a href="{{ url_for('index') }}">Back</a></div>
          </div>

          <div class="flash">
            {% with messages = get_flashed_messages(with_categories=true) %}
              {% if messages %}
                {% for category, message in messages %}
                  <div class="msg {{ category }}">{{ message }}</div>
                {% endfor %}
              {% endif %}
            {% endwith %}
          </div>

          <form method="post" autocomplete="off" novalidate>
            <h3 class="section-title">Reddit API</h3>
            <div class="group two-cols">
              <div class="field">
                <label for="REDDIT_CLIENT_ID">Client ID</label>
                <input type="text" id="REDDIT_CLIENT_ID" name="REDDIT_CLIENT_ID" value="{{ values['REDDIT_CLIENT_ID'] }}" maxlength="128" />
              </div>
              <div class="field">
                <label for="REDDIT_CLIENT_SECRET">Client Secret</label>
                <input type="password" id="REDDIT_CLIENT_SECRET" name="REDDIT_CLIENT_SECRET" value="" autocomplete="new-password" maxlength="256" />
                {% if has_secret.get('REDDIT_CLIENT_SECRET') %}
                  <div class="muted" style="font-size:12px;">Saved (hidden). Leave blank to keep.</div>
                {% endif %}
              </div>
              <div class="field">
                <label for="REDDIT_USERNAME">Username</label>
                <input type="text" id="REDDIT_USERNAME" name="REDDIT_USERNAME" value="{{ values['REDDIT_USERNAME'] }}" maxlength="128" />
              </div>
              <div class="field">
                <label for="REDDIT_PASSWORD">Password / App Password</label>
                <input type="password" id="REDDIT_PASSWORD" name="REDDIT_PASSWORD" value="" autocomplete="new-password" maxlength="256" />
                {% if has_secret.get('REDDIT_PASSWORD') %}
                  <div class="muted" style="font-size:12px;">Saved (hidden). Leave blank to keep.</div>
                {% endif %}
              </div>
              <div class="field" style="grid-column: 1 / -1;">
                <label for="REDDIT_USER_AGENT">User Agent</label>
                <input type="text" id="REDDIT_USER_AGENT" name="REDDIT_USER_AGENT" value="{{ values['REDDIT_USER_AGENT'] }}" maxlength="200" placeholder="example: unmoderated_subreddit_finder/1.0 by /u/yourname" />
              </div>
            </div>

            <h3 class="section-title" style="margin-top:14px;">App</h3>
            <div class="group two-cols">
              <div class="field">
                <label for="PORT">Port</label>
                <input type="text" id="PORT" name="PORT" value="{{ values['PORT'] }}" maxlength="10" />
              </div>
              <div class="field">
                <label for="SITE_URL">Site URL (canonical)</label>
                <input type="text" id="SITE_URL" name="SITE_URL" value="{{ values['SITE_URL'] }}" maxlength="200" />
              </div>
              <div class="field" style="grid-column: 1 / -1;">
                <label for="FLASK_SECRET_KEY">Flask Secret Key</label>
                <input type="password" id="FLASK_SECRET_KEY" name="FLASK_SECRET_KEY" value="" autocomplete="new-password" maxlength="256" />
                {% if has_secret.get('FLASK_SECRET_KEY') %}
                  <div class="muted" style="font-size:12px;">Saved (hidden). Leave blank to keep.</div>
                {% endif %}
              </div>
            </div>

            <h3 class="section-title" style="margin-top:14px;">Performance</h3>
            <div class="group two-cols">
              <div class="field">
                <label for="REDDIT_TIMEOUT">HTTP timeout (seconds)</label>
                <input type="text" id="REDDIT_TIMEOUT" name="REDDIT_TIMEOUT" value="{{ values['REDDIT_TIMEOUT'] }}" maxlength="3" placeholder="10" />
                <div class="muted" style="font-size:12px;">Use 5–30. Lower fails fast on network hiccups.</div>
              </div>
            </div>

            <div class="group">
              <div class="muted" style="font-size:12px;">Blank fields are ignored (existing values kept). Settings are saved to <code>{{ dotenv_path }}</code>.</div>
            </div>

            <div class="actions" style="margin-top:8px; display:grid; gap:10px; grid-template-columns: 1fr 1fr;">
              <button type="submit" name="action" value="save">Save Settings</button>
              <button type="submit" name="action" value="test" class="secondary">Test Credentials</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </body>
  </html>
